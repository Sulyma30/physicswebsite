{% extends "upho/layout.html" %}

{% block title %} Material {% endblock %}

{% block script %}
<script type="text/babel">

  class MaterialRow extends React.Component {
    render() {
      return (
        <tr style={this.props.style}>
            <td>{this.props.row.tasks}</td>
            <td></td>
            <td className="text-right pr-2">{this.props.row.literature.short_title} {this.props.row.literature.pdf ? <a href={this.props.row.literature.pdf}><i className="fas fa fa-download"></i></a> : null}</td>
        </tr>
      );
    }
  }
  
  class MaterialTable extends React.Component {
    render() {
      return (
        <table className="table table-striped mb-4">
          <tbody>
            {this.props.rows}
          </tbody>
        </table>
      );
    }
  }

  class AllTasks extends React.Component {
    render() {
      const all_rows = [];
      const all_style = {borderLeft: "4px solid lightgray"}
      this.props.all.forEach(row => {
        all_rows.push(
          <MaterialRow row={row} key={row.literature} style={all_style} />
        );
      });
      return(
        <div className="tab-pane fade" id="all" role="tabpanel">
          <MaterialTable rows={all_rows} />
        </div>
      );
    }

  }

  class ChosenTasks extends React.Component {
    render() {
      const novice_rows = [];
      const novice_style={borderLeft: "4px solid lightgreen"};
  
      const advanced_rows = [];
      const advanced_style={borderLeft: "4px solid orange"};

      const expert_rows = [];
      const expert_style={borderLeft: "4px solid red"};

      this.props.chosen.novice.forEach((row) => {
        novice_rows.push(
          <MaterialRow row={row} key={row.literature} style={novice_style} />
        );
      });
      this.props.chosen.advanced.forEach((row) => {
        advanced_rows.push(
          <MaterialRow row={row} key={row.literature} style={advanced_style} />
        );
      });
      this.props.chosen.expert.forEach((row) => {
        expert_rows.push(
          <MaterialRow row={row} key={row.literature} style={expert_style} />
        );
      });
      
      return (
        <div className="tab-pane fade in show active" id="recommended" role="tabpanel">
          <MaterialTable rows={novice_rows} />
          <MaterialTable rows={advanced_rows} />
          <MaterialTable rows={expert_rows} />
        </div>
      );
    }
  }

//Here we should use type (problems or theory) and info about current theme (from material) and get information about neighbourhood themes and with url_for open the page (saving the type)
  class NextPrevious extends React.Component {
    render() {
      return (
        <div className="row justify-content-sm-between justify-content-center my-4">
          <div className="pl-3 col-sm-6 col-12 d-flex justify-content-center justify-content-sm-start">
        {% if previous %}
            <a href="{% url 'material' previous.id task %}" className="btn btn-outline-bg"><i className="fas fa-lg fa-angle-left"></i> {{ previous.title }} </a>
          {% endif %}
          </div>
          <div className="pr-3 col-sm-6 col-12 d-flex justify-content-center justify-content-sm-end">
          {% if next %}
            <a href="{% url 'material' next.id task %}" className="btn btn-outline-bg">{{ next.title }}<i className="fas fa-lg fa-angle-right"></i></a>
          {% endif %}
          </div>
        </div>
      );
    }
  }

  class ContentHeaders extends React.Component {
    render() {
      return (
        <ul className="nav nav-pills material-pills mx-3">
          
          {
            this.props.task=="problems" ?
            <li className="nav-item px-0">
            <a className="nav-link active mx-0" id="recommended-tab" data-toggle="tab" href="#recommended" role="tab"
              aria-controls="recommended-tasks" aria-selected="true">Годні задачі</a></li> : 
            <li className="nav-item px-0 pt-2">
            Сторінки
            </li>
          }
          
          {
            this.props.all.length != 0 ? 
            <li className="nav-item px-0">
            <a className="nav-link mx-0" id="all-tab" data-toggle="tab" href="#all" role="tab" aria-controls="all-tasks"
              aria-selected="false">Всі</a>
          </li> : null
          }
          <li className="nav-item ml-auto pr-2 pt-2">
            Літ<span className="d-none d-sm-inline-block">ерату</span><span className="d-inline-block d-sm-none">-</span>ра
          </li>
        </ul>
      );
    }
  }


  class Content extends React.Component {
    render() {
      return (
        <div className="col-md-12 col-xl-8">
          <ContentHeaders all={this.props.tasks.all} task={this.props.task} />
          <div className="tab-content pt-1 px-3">
            <ChosenTasks chosen={this.props.tasks.chosen} />
            <AllTasks all={this.props.tasks.all} />
          </div>
          <NextPrevious />
        </div>
      );
    }
  }

//From backend I get type (problems or theory) and theme_id and with API I get material

const material = {{ material }}
const task = '{{ task }}'

ReactDOM.render(<Content tasks={material} task={task} />, document.getElementById('material-content'));

</script>
{% endblock %}

{% block header %}
<div class="material-header container-fluid d-flex flex-column justify-content-between">

  <!-- Breadcrumb -->
  <div class="row justify-content-end mt-3">
    <nav class="col-12 col-sm-auto" aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'materials' %}">{{theme.section.supersection.title}}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'materials' %}">{{theme.section.title}}</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{theme.title}}</li>
      </ol>
    </nav>
  </div>

  <!-- Header with buttons -->

  <div class="row align-items-end px-4">
    {% if task == "problems" %}
    <div class="display-3 text-center text-white col-12 col-sm-auto">Задачі</div>
    <a href="{% url 'material' theme.id 'theory' %}" role="button" class="btn btn-outline-white btn-rounded mx-1 mb-3 mr-auto">Теорія</a>
    {% elif task == "theory" %}
    <div class="display-3 text-center text-white col-12 col-sm-auto">Теорія</div>
    <a href="{% url 'material' theme.id 'problems' %}" role="button" class="btn btn-outline-white btn-rounded mx-1 mb-3 mr-auto">Задачі</a>
    {% endif %}

    <!-- Button trigger modal !-->
    <div role="button" class="text-white mb-3" data-toggle="modal" data-target="#ModalCenter">
      Як тут вчитися?
    </div>

  <!-- Modal -->
  <div class="modal fade" id="ModalCenter" tabindex="-1" role="dialog" aria-labelledby="ModalCenterTitle"
    aria-hidden="true">

    <!-- Add .modal-dialog-centered to .modal-dialog to vertically center the modal -->
    <div class="modal-dialog modal-dialog-centered" role="document">


      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="ModalLongTitle">З чого почати?</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          1. Виберіть рівень та літературу, яку можна завантажити на цій же сторінці<br>
          2. Почніть з теорії, потім задачі<br>
          3. Комбінуйте теорію і задачі, поступово збільшуючи складність (зверху вниз)<br>
          4. Якщо треба нову тему, то виберіть знизу сусідні або ж перейдіть до пошуку тем
        </div>
        <div class="modal-footer d-flex justify-content-center">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Зрозуміло</button>
        </div>
      </div>

    </div>

  </div>
  
</div>
{% endblock %}

{% block main %}

<!-- Content -->
<div class="row justify-content-center px-2 pt-4 pt-xl-5" id="material-content">
</div>

{% endblock %}